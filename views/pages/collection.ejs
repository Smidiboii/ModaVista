<!doctype html>
<html lang="fr" data-bs-theme="auto">

<head>
    <%- include ("../partials/head.ejs") %>
</head>

<body>
    <main>
        <div class="container py-4">
            <%- include ("../partials/header.ejs") %>
                <div id="IMGFond" class="bg-image"
                    style="align-content: center; background-image: url('../<%=fondDEcran%>'); background-size: cover; background-repeat: no-repeat; text-align: justify;">

                    <br>
                    <div style="background-color: rgb(11, 5, 20); height: 20%;">
                        <label style="color: aliceblue; margin-left: 10%;margin-top: 1%;" for="collections">Changez la
                            saison:</label>

                        <select style="height: auto; vertical-align: middle; text-align: center;"
                            name="SelectionCollections" id="SelectionCollections" onchange="ChangerCollection()">
                            <option value="0">Selectionnez Une saison</option>
                            <%for(var i=0; i<collections.length; i++){%>
                                <option style="vertical-align: auto; height: 15%;"
                                    value="<%=collections[i].CollectionID%>">
                                    <%=collections[i].NomCollection%>
                                </option>
                                <%}%>
                        </select>
                        <p></p>
                        <h1 class="text-center" ; style="background-color: blanchedalmond; margin-top: 3%;">
                            <!-- <h1 style="text-align: center;  background-color: blanchedalmond; margin-top: 1%;"> -->
                            <%=collection%>
                        </h1>
                    </div>

                    <br>
                    <div id="AffichageProduits">
                        <% for(var i=0; i<produits.length; i++) { %>
                            <% if(i%3==0 || i==0){ %>
                                <div class="row py-5 m-auto" style="max-width:1000px;">
                                    <% AfficherCarte(i); %>
                                        <% }else{ %>
                                            <% AfficherCarte(i); %>
                                                <% } %>
                                                    <%if((i+1)%3==0 || i+1==produits.length){ %>
                                </div>
                                <% } %>
                                    <% } %>

                                        <% function AfficherCarte(i){ %>
                                            <div class="col-md-4">
                                                <a href="/produit/<%=produits[i]._id%>">
                                                    <div class="card">
                                                        <img src="../assets/img/IMG_<%=produits[i].Nom%>.jpg"
                                                            onerror="this.onerror=null; this.src='../<%=imgNonTrouvee%>';"
                                                            class="card-img-top">
                                                        <div class="card-body">
                                                            <h5 class="card-title">
                                                                <%=produits[i].Nom %>
                                                            </h5>
                                                            <p class="fw-bolder">
                                                                <%=produits[i].Prix %>$
                                                            </p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                            <% } %>
                    </div>

                </div>
                <script>
                    function ChangerCollection() {
                        let url = "http://localhost:3000/api/collection?id=" + document.getElementById("SelectionCollections").value;

                        if (document.getElementById("SelectionCollections").value != 0) {
                            fetch(url)
                                .then(response => response.json())
                                .then(data => {
                                    const contenantFonDEcran = document.getElementById("IMGFond");
                                    contenantFonDEcran.style.backgroundImage = "url(\"../" + data.fondDEcran + "\")";
                                    AfficherProduits(data);
                                }).catch(error => {
                                    console.log(error);
                                })
                        }
                    }
                    function AfficherProduits(data) {
                        divProduits = document.getElementById("AffichageProduits");
                        divProduits.innerHTML = "";
                        var contenant = "";
                        for (let index = 0; index < data.produits.length; index++) {
                            if (index % 3 == 0 || index == 0) {
                                contenant += `<div class="row py-5 m-auto" style="max-width:1000px;">
                                    ${AfficherProduit(data.produits[index], data.imgNonTrouvee)}`;
                            } else {
                                contenant += AfficherProduit(data.produits[index], data.imgNonTrouvee);
                            }
                            if ((index + 1) % 3 == 0 || index + 1 == data.produits.length) {
                                contenant += `</div>`;
                            }
                        }
                        divProduits.innerHTML = contenant;
                    }
                    function AfficherProduit(produit, imgNonTrouvee) {
                        return `<div class="col-md-4">
                                                <a href="/produit/${produit._id}">
                                                    <div class="card">
                                                        <img src="../assets/img/IMG_${produit.Nom}.jpg"
                                                            onerror="this.onerror=null; this.src='../${imgNonTrouvee}';"
                                                            class="card-img-top">
                                                        <div class="card-body">
                                                            <h5 class="card-title">
                                                                ${produit.Nom}
                                                            </h5>
                                                            <p class="fw-bolder">
                                                                ${produit.Prix}$
                                                            </p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>`;
                    }
                </script>
        </div>
    </main>
    <%- include ("../partials/footer.ejs") %>
</body>

</html>