<!DOCTYPE html>
<html>
<%- include ("../partials/head.ejs") %>

    <body>
        <!-- navbar-->
        <%- include ("../partials/navbar.ejs") %>
            <div id="all">
                <div id="content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 order-1 order-lg-2">
                                <div id="productMain" class="row">
                                    <div class="col-md-6">
                                        <div data-slider-id="1" class="owl-carousel shop-detail-carousel">
                                            <div class="item">
                                                <img src="/assets/img/<%= produit.nom %>.jpg" alt=""
                                                    class="img-fluid" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="box">
                                            <h1 class="text-center">
                                                <%= produit.nom %>
                                            </h1>
                                            <p class="goToDescription">
                                                <a href="#details" class="scroll-to">Faites défiler jusqu'aux détails du
                                                    produit</a>
                                            </p>
                                            <p class="price">$<%= produit.prix %>
                                            </p>
                                            <p class="text-center buttons">
                                                <a href="#" class="btn btn-primary" id="addToCart"><i
                                                        class="fa fa-shopping-cart"></i>
                                                    ajouter au panier</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div id="details" class="box">
                                    <p></p>
                                    <h4>Product details</h4>
                                    <p>
                                        <%= produit.description %>
                                    </p>
                                    <h4>Marque</h4>
                                    <p>
                                        <%= produit.marque %>
                                    </p>
                                    <h4>Taille</h4>
                                    <p>
                                        <%= produit.taille %>
                                    </p>
                                    <h4>Genre</h4>
                                    <p>
                                        <%= produit.genre %>
                                    </p>

                                    <hr />
                                </div>
                            </div>
                            <!-- /.col-md-9-->
                        </div>
                    </div>
                </div>
            </div>
            <%- include ("../partials/footer.ejs") %>

                <!-- JavaScript files-->
                <%- include ("../partials/javascript.ejs") %>
    </body>
    <script>
        const addToCartButton = document.getElementById('addToCart');

        addToCartButton.addEventListener('click', function (event) {
            event.preventDefault();
            const token = getCookie('token');

            // Vérifier si le token est disponible
            if (token) {
                fetch('/api/cart', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                    , body: JSON.stringify({
                        'produitsID': ['<%= produit._id %>']
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        alert('Article ajouté au panier');
                    })
                    .catch(error => {
                        console.error('Erreur lors de la requête fetch :', error);
                        alert('Erreur lors de la requête.');
                    });
            } else {
                alert('Veuillez vous connecter.');
            }
        });
    </script>

</html>