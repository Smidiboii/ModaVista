<html lang="fr" data-bs-theme="auto">

<head>
    <%- include ("../partials/head.ejs") %>
        <style>
            body {
                background-image: url('../assets/img/loginb.jpg');
                background-size: 100% 100%;
                background-position: center;
                background-color: rgba(255, 255, 255, 0.7);
                background-repeat: no-repeat;
                opacity: 0;
                transition: opacity 1s ease-in-out;
                font-family: 'Arial', sans-serif;
                margin: 0;
            }

            body.loaded {
                opacity: 1;
            }

            .main-content {
                opacity: 0;
                transform: translateY(20px);
                transition: opacity 1s ease-in-out, transform 1s ease-in-out;
                padding: 20px;
                margin: 0 auto;
            }

            body.loaded .main-content {
                opacity: 1;
                transform: translateY(0);
            }

            .card {
                background-color: #fff;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                border-radius: 8px;
                padding: 20px;
                max-width: 600px;
                margin: 0 auto;
            }

            h1 {
                color: #000;
                text-align: center;
            }

            label {
                color: #000;
            }

            .form-control {
                background-color: #fff;
                color: #000;
                border: 1px solid #000;
                border-radius: 4px;
            }
        </style>
</head>

<body>
    <main class="main-content">
        <%- include ("../partials/header.ejs") %>
            <form class="card" action="/login" method="post">
                <h1>Se connecter</h1>
                <div class="mb-3">
                    <label for="inputEmail" class="form-label">Email</label>
                    <input type="text" class="form-control" id="inputEmail" name="email" required>
                </div>
                <div class="mb-3">
                    <label for="inputPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="inputPassword" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Se connecter</button>
            </form>
    </main>

    <script defer>
        document.addEventListener('DOMContentLoaded', function () {
            document.body.classList.add('loaded');
        });
        document.querySelector('form').addEventListener('submit', function (event) {
            event.preventDefault();
            debounceLogin();
        });

        const debounceLogin = debounce(function () {
            login();
        }, 100);

        function debounce(func, wait) {
            let timeout;
            return function () {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(function () {
                    func.apply(context, args);
                }, wait);
            };
        }

        function login() {
            const email = document.getElementById('inputEmail').value;
            const password = document.getElementById('inputPassword').value;
            console.log('Email:', email);
            console.log('Password:', password);

            fetch("/login", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email,
                    password
                }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'success') {
                        alert('Login successful!');
                        window.location.href = '/compte'; // Redirige l'utilisateur vers la page de compte, mais on la pas encore créée sur la bd
                    } else {
                        alert('Login failed.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
</body>

</html>